# 使用精簡版 Node 基底
FROM node:20-slim

# =======================================
# 1. 安裝 ffmpeg
# =======================================
RUN apt-get update && apt-get install -y \
    ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# =======================================
# 2. 建立 app 目錄
# =======================================
WORKDIR /app

# =======================================
# 3. 先複製 package.json 做 npm install（利用 cache）
# =======================================
COPY package*.json ./

RUN npm install --production

# =======================================
# 4. 複製專案所有內容
# =======================================
COPY . .

# =======================================
# 5. 預設啟動程式
# =======================================
CMD ["npm", "start"]
